<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jeffery.template.data.mapper.UserMapper" >
	<resultMap id="UserMap" type="com.jeffery.template.data.model.UserModel" >
		<result column="id" property="id" />
		<result column="gmt_create" property="gmtCreate" />
		<result column="gmt_modified" property="gmtModified" />
		<result column="name" property="name" />
		<result column="email" property="email" />
	</resultMap>

	<sql id="sql_select"  >
		<![CDATA[
			SELECT
				id, gmt_create, gmt_modified, name, email
			FROM user
		]]>
	</sql>
	
	<sql id="sql_limit">
		LIMIT #{pageSize} OFFSET #{startNum}
	</sql>
	
	<sql id="sql_order">
		<![CDATA[
			ORDER BY id DESC
		]]>
	</sql>
	
	<sql id="sql_where">
		WHERE 1=1
		<if test="idList != null and idList.size() > 0">
			AND id IN
			<foreach collection="idList" index="index" item="item" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="id != null"> AND id = #{id} </if>
		<if test="gmtCreate != null"> AND gmt_create = #{gmtCreate} </if>
		<if test="gmtModified != null"> AND gmt_modified = #{gmtModified} </if>
		<if test="name != null"> AND name = #{name} </if>
		<if test="email != null"> AND email = #{email} </if>
	</sql>
	
	<select id="query" parameterType="com.jeffery.template.data.param.UserParam" resultMap="UserMap" >
		<include refid="sql_select" />
		<include refid="sql_where" />
		<include refid="sql_order" />
		<include refid="sql_limit" />
	</select>

	<select id="find" parameterType="java.lang.Long" resultMap="UserMap" >
		<include refid="sql_select" />
		<![CDATA[
			WHERE id = #{id}
		]]>
	</select>
	
	<select id="count" parameterType="com.jeffery.template.data.param.UserParam" resultType="java.lang.Long" >
		SELECT COUNT(*) FROM user
		<include refid="sql_where" />
	</select>
	
	<insert id="create" useGeneratedKeys="true" keyProperty="id" parameterType="com.jeffery.template.data.model.UserModel" >
		<![CDATA[
			INSERT INTO user(gmt_create, gmt_modified, name, email)
			VALUES(now(), now(), #{name}, #{email})
		]]>
	</insert>
	
	<insert id="batchCreate" useGeneratedKeys="true" keyProperty="id" parameterType="java.util.List" >
		INSERT INTO user(gmt_create, gmt_modified, name, email)
		VALUES
		<foreach collection="list" index="index" item="item" separator=",">
			(now(), now(), #{item.name}, #{item.email})
		</foreach>
	</insert>

	<update id="update" parameterType="java.util.Map" >
		UPDATE user
		SET gmt_modified = now()
		<if test="userName != null">
			, name = #{this.name}
		</if>
		<if test="passWord != null">
			, email = #{this.email}
		</if>
		WHERE
			id = #{this.id}
	</update>

	<delete id="delete" parameterType="java.lang.Long" >
		DELETE FROM user WHERE id =#{id}
	</delete>
</mapper>