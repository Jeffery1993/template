<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="${_dal_package_name}.mapper.${_table_name}Mapper" >
	<resultMap id="${_table_name}Map" type="${_dal_package_name}.model.${_table_name}Model" >
		<result column="id" property="id" />
		<result column="gmt_create" property="gmtCreate" />
		<result column="gmt_modified" property="gmtModified" />
		${_column_and_property}
	</resultMap>

	<sql id="sql_select"  >
		<![CDATA[
			SELECT
				id, gmt_create, gmt_modified, ${_columns}
			FROM ${_table}
		]]>
	</sql>
	
	<sql id="sql_limit">
		LIMIT #{pageSize} OFFSET #{startNum}
	</sql>
	
	<sql id="sql_order">
		<![CDATA[
			ORDER BY id DESC
		]]>
	</sql>
	
	<sql id="sql_where">
		WHERE 1=1
		<if test="idList != null and idList.size() > 0">
			AND id IN
			<foreach collection="idList" index="index" item="item" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="id != null"> AND id = #{id} </if>
		<if test="gmtCreate != null"> AND gmt_create = #{gmtCreate} </if>
		<if test="gmtModified != null"> AND gmt_modified = #{gmtModified} </if>
		${_sql_where}
	</sql>
	
	<select id="query" parameterType="${_dal_package_name}.param.${_table_name}Param" resultMap="${_table_name}Map" >
		<include refid="sql_select" />
		<include refid="sql_where" />
		<include refid="sql_order" />
		<include refid="sql_limit" />
	</select>

	<select id="find" parameterType="java.lang.Long" resultMap="${_table_name}Map" >
		<include refid="sql_select" />
		<![CDATA[
			WHERE id = #{id}
		]]>
	</select>
	
	<select id="count" parameterType="${_dal_package_name}.param.${_table_name}Param" resultType="java.lang.Integer" >
		SELECT COUNT(*) FROM ${_table}
		<include refid="sql_where" />
	</select>
	
	<insert id="create" useGeneratedKeys="true" keyProperty="id" parameterType="${_dal_package_name}.model.${_table_name}Model" >
		<![CDATA[
			INSERT INTO ${_table}(gmt_create, gmt_modified, ${_columns})
			VALUES(now(), now(), #{name}, #{email}, ${_create_columns})
		]]>
	</insert>
	
	<insert id="batchCreate" useGeneratedKeys="true" keyProperty="id" parameterType="java.util.List" >
		INSERT INTO ${_table}(gmt_create, gmt_modified, ${_columns})
		VALUES
		<foreach collection="list" index="index" item="item" separator=",">
			(now(), now(), #{item.name}, #{item.email}, ${_batch_create_columns})
		</foreach>
	</insert>

	<update id="update" parameterType="java.util.Map" >
		UPDATE ${_table}
		SET gmt_modified = now()
		<if test="userName != null">
			, name = #{this.name}
		</if>
		<if test="passWord != null">
			, email = #{this.email}
		</if>
		${_update_columns}
		WHERE
			id = #{this.id}
	</update>

	<delete id="delete" parameterType="java.lang.Long" >
		DELETE FROM ${_table} WHERE id =#{id}
	</delete>
</mapper>